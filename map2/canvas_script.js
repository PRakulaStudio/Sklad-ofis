function _map(obj,clas,name,x,y){obj.beginPath();obj.fillStyle='#8dc63f';obj.strokeStyle='#fff';obj.lineWidth=2;var coords_text=$(clas).attr('coords');var coords_arr=coords_text.split(',');for(i=0;i<=coords_arr.length;i++){obj.lineTo(coords_arr[i],coords_arr[i+1]);i++;}obj.closePath();obj.stroke();obj.fill();obj.beginPath();obj.fillStyle='#fff';obj.font='bold 11px Arial';obj.textBaseline='top';obj.fillText(name,x,y);obj.closePath();obj.fill();}function _line(obj,el_line,color_fon){if(color_fon)obj.fillStyle=color_fon;var coords_text=$(el_line).attr('coords');var coords_arr=coords_text.split(',');obj.beginPath();for(i=0;i<=coords_arr.length;i++){obj.lineTo(coords_arr[i],coords_arr[i+1]);i++;}obj.closePath();obj.fill();}function _stor(obj,clas){obj.fillStyle='rgba(103,101,103,0.3)';var coords_text=$('.'+clas).attr('coords');var coords_arr=coords_text.split(',');obj.beginPath();for(i=0;i<=coords_arr.length;i++){obj.lineTo(coords_arr[i],coords_arr[i+1]);i++;}obj.closePath();obj.fill();}function action(obj,obj2,clas,s_class,area){$('.'+clas).bind('mouseover',function(){_stor(obj,clas);$('#img_block .'+s_class).addClass('txt_act');}).bind('mouseout',function(){obj.clearRect(0,0,608,439);$('#img_block .'+s_class).removeClass('txt_act');});var switcher=0;$("."+clas).click(function(){if(switcher==0){console.log(area+' включено');set_search_param('rayonF[]','МО '+area,'.'+clas);$(this).unbind('mouseout').unbind('mouseover');switcher=1;obj.clearRect(0,0,608,439);_stor(obj2,clas);$('#img_block .'+s_class).addClass('txt_act');}else{console.log(area+' выключено');remove_search_param('rayonF[]','МО '+area,'.'+clas);$(this).bind('mouseover',function(){_stor(obj,clas);$('#img_block .'+s_class).addClass('txt_act');}).bind('mouseout',function(){obj.clearRect(0,0,608,439);$('#img_block .'+s_class).removeClass('txt_act');});switcher=0;_stor(obj,clas);obj2.clearRect(0,0,608,439);}});}function _met(obj,n_class,line_class,area){_line(obj,$('.'+line_class),'#629713');$('.'+line_class).bind('mouseover',function(){_line(obj,$(this),'#456f09');$('.'+n_class).addClass('act_met');}).bind('mouseout',function(){obj.clearRect(0,0,608,439);_line(obj,$('.'+line_class),'#629713');$('.'+n_class).removeClass('act_met');});$("."+line_class).click(function(){if($(this).attr('class')==line_class){console.log(area+' включено');set_search_param('shosseF[]',area,'.'+line_class);_line(obj,$(this),'#fd8f37');$(this).unbind('mouseout').unbind('mouseover').addClass('line_act');$('.'+n_class).addClass('act_met');}else{console.log(area+' выключено');remove_search_param('shosseF[]',area,'.'+line_class);obj.clearRect(0,0,608,439);_line(obj,$('.'+line_class),'#629713');$(this).bind('mouseover',function(){_line(obj,$(this),'#456f09');$('.'+n_class).addClass('act_met');}).bind('mouseout',function(){obj.clearRect(0,0,608,439);_line(obj,$('.'+line_class),'#629713');$('.'+n_class).removeClass('act_met');});$(this).removeClass('line_act');$('.'+n_class).removeClass('act_met');_line(obj,$(this),'#456f09');}});}function rayony(obj,rayon_clas,name,x,y,additional){addclass=additional?','+additional:'';$(rayon_clas+addclass).bind('mouseover',function(){_map(obj,rayon_clas,name,x,y);if(additional)_map(obj,additional,'',0,0);}).bind('mouseout',function(){obj.clearRect(0,0,608,439);});var jak1=0;$(rayon_clas+addclass).click(function(){if(jak1==0){$(this).unbind('mouseout').unbind('mouseover');jak1=1;console.log(name+' включено');set_search_param('rayonF[]',name+' Москва',rayon_clas);}else{$(rayon_clas+addclass).bind('mouseover',function(){_map(obj,rayon_clas,name,x,y);}).bind('mouseout',function(){obj.clearRect(0,0,608,439);});jak1=0;console.log(name+' выключено');remove_search_param('rayonF[]',name+' Москва',rayon_clas);}});}function run_canvas(){var canvas1=document.getElementById('canvas_id1');var canvas2=document.getElementById('canvas_id2');var canvas3=document.getElementById('canvas_id3');var canvas4=document.getElementById('canvas_id4');var canvas5=document.getElementById('canvas_id5');var canvas6=document.getElementById('canvas_id6');var canvas7=document.getElementById('canvas_id7');var canvas8=document.getElementById('canvas_id8');var canvas9=document.getElementById('canvas_id9');var canvas10=document.getElementById('canvas_id10');var canvas_line1=document.getElementById('canvas_lin1');var canvas_line2=document.getElementById('canvas_lin2');var canvas_line3=document.getElementById('canvas_lin3');var canvas_line4=document.getElementById('canvas_lin4');var canvas_line5=document.getElementById('canvas_lin5');var canvas_line6=document.getElementById('canvas_lin6');var canvas_line7=document.getElementById('canvas_lin7');var canvas_line8=document.getElementById('canvas_lin8');var canvas_line9=document.getElementById('canvas_lin9');var canvas_line10=document.getElementById('canvas_lin10');var canvas_line11=document.getElementById('canvas_lin11');var canvas_line12=document.getElementById('canvas_lin12');var canvas_line13=document.getElementById('canvas_lin13');var canvas_line14=document.getElementById('canvas_lin14');var canvas_line12_n=document.getElementById('canvas_lin12_n');var canvas_line11_n=document.getElementById('canvas_lin11_n');var canvas_line6_n=document.getElementById('canvas_lin6_n');var canvas_line7_n=document.getElementById('canvas_lin7_n');var new_line_1=document.getElementById('new_line_1');var new_line_2=document.getElementById('new_line_2');var new_line_3=document.getElementById('new_line_3');var new_line_4=document.getElementById('new_line_4');var new_line_5=document.getElementById('new_line_5');var new_line_6=document.getElementById('new_line_6');var new_line_7=document.getElementById('new_line_7');var canvas_stor1=document.getElementById('stor_1');var canvas_stor2=document.getElementById('stor_2');var canvas_stor3=document.getElementById('stor_3');var canvas_stor4=document.getElementById('stor_4');var canvas_stor5=document.getElementById('stor_5');var canvas_stor6=document.getElementById('stor_6');var canvas_stor7=document.getElementById('stor_7');var canvas_stor8=document.getElementById('stor_8');var canvas_stor1_hov=document.getElementById('stor_1_hov');var canvas_stor2_hov=document.getElementById('stor_2_hov');var canvas_stor3_hov=document.getElementById('stor_3_hov');var canvas_stor4_hov=document.getElementById('stor_4_hov');var canvas_stor5_hov=document.getElementById('stor_5_hov');var canvas_stor6_hov=document.getElementById('stor_6_hov');var canvas_stor7_hov=document.getElementById('stor_7_hov');var canvas_stor8_hov=document.getElementById('stor_8_hov');var zelen_grad=document.getElementById('canvas_zelen');if(canvas1.getContext){var rc_lin1=canvas_line1.getContext('2d');var rc_lin2=canvas_line2.getContext('2d');var rc_lin3=canvas_line3.getContext('2d');var rc_lin4=canvas_line4.getContext('2d');var rc_lin5=canvas_line5.getContext('2d');var rc_lin6=canvas_line6.getContext('2d');var rc_lin6_n=canvas_line6_n.getContext('2d');var rc_lin7=canvas_line7.getContext('2d');var rc_lin7_n=canvas_line7_n.getContext('2d');var rc_lin8=canvas_line8.getContext('2d');var rc_lin9=canvas_line9.getContext('2d');var rc_lin10=canvas_line10.getContext('2d');var rc_lin11=canvas_line11.getContext('2d');var rc_lin11_n=canvas_line11_n.getContext('2d');var rc_lin12=canvas_line12.getContext('2d');var rc_lin12_n=canvas_line12_n.getContext('2d');var rc_lin13=canvas_line13.getContext('2d');var rc_lin14=canvas_line14.getContext('2d');var rc_nline_1=new_line_1.getContext('2d');var rc_nline_2=new_line_2.getContext('2d');var rc_nline_3=new_line_3.getContext('2d');var rc_nline_4=new_line_4.getContext('2d');var rc_nline_5=new_line_5.getContext('2d');var rc_nline_6=new_line_6.getContext('2d');var rc_nline_7=new_line_7.getContext('2d');var rc1=canvas1.getContext('2d');var rc2=canvas2.getContext('2d');var rc3=canvas3.getContext('2d');var rc4=canvas4.getContext('2d');var rc5=canvas5.getContext('2d');var rc6=canvas6.getContext('2d');var rc7=canvas7.getContext('2d');var rc8=canvas8.getContext('2d');var rc9=canvas9.getContext('2d');var rc10=canvas10.getContext('2d');var rc_stor1=canvas_stor1.getContext('2d');var rc_stor2=canvas_stor2.getContext('2d');var rc_stor3=canvas_stor3.getContext('2d');var rc_stor4=canvas_stor4.getContext('2d');var rc_stor5=canvas_stor5.getContext('2d');var rc_stor6=canvas_stor6.getContext('2d');var rc_stor7=canvas_stor7.getContext('2d');var rc_stor8=canvas_stor8.getContext('2d');var rc_stor1_hov=canvas_stor1_hov.getContext('2d');var rc_stor2_hov=canvas_stor2_hov.getContext('2d');var rc_stor3_hov=canvas_stor3_hov.getContext('2d');var rc_stor4_hov=canvas_stor4_hov.getContext('2d');var rc_stor5_hov=canvas_stor5_hov.getContext('2d');var rc_stor6_hov=canvas_stor6_hov.getContext('2d');var rc_stor7_hov=canvas_stor7_hov.getContext('2d');var rc_stor8_hov=canvas_stor8_hov.getContext('2d');var rc_zelen_grad=zelen_grad.getContext('2d');function zelen_grag_text(color_txt){rc_zelen_grad.beginPath();rc_zelen_grad.fillStyle=color_txt;rc_zelen_grad.font='bold 8px Verdana';rc_zelen_grad.textBaseline='top';rc_zelen_grad.fillText('Зеленоград',113,56);rc_zelen_grad.closePath();rc_zelen_grad.fill();}zelen_grag_text('#74989c');}else{}action(rc_stor1_hov,rc_stor1,'storona1','s6','Северо-Восток');action(rc_stor2_hov,rc_stor2_hov,'storona2','s5','Север');action(rc_stor3_hov,rc_stor3_hov,'storona3','s4','Северо-Запад');action(rc_stor4_hov,rc_stor4_hov,'storona4','s3','Запад');action(rc_stor5_hov,rc_stor5_hov,'storona5','s2','Юго-Запад');action(rc_stor6_hov,rc_stor6_hov,'storona6','s1','Юг');action(rc_stor7_hov,rc_stor7_hov,'storona7','s8','Юго-Восток');action(rc_stor8_hov,rc_stor8_hov,'storona8','s7','Восток');_met(rc_lin1,'n11','line_map1','Новорязанское');_met(rc_lin2,'n12','line_map2','Егорьевское');_met(rc_lin3,'n13','line_map3','Носовихинское');_met(rc_lin4,'n14','line_map4','Горьковское');_met(rc_lin5,'n2','line_map5','Ярославское');_met(rc_lin6,'n1','line_map6','Дмитровское');_met(rc_lin7,'n3','line_map7','Ленинградское');_met(rc_lin8,'n4','line_map8','Новорижское');_met(rc_lin9,'n6','line_map9','Минское');_met(rc_lin10,'n5','line_map10','Киевское');_met(rc_lin11,'n8','line_map11','Варшавское');_met(rc_lin12,'n7','line_map12','Каширское');_met(rc_lin13,'n9','line_map13','Симферопольское');_met(rc_lin14,'n10','line_map14','Новокаширское');_met(rc_nline_1,'n15','new_line_1','Щелковское');_met(rc_nline_3,'n17','new_line_3','Осташковское');_met(rc_nline_4,'n18','new_line_4','Пятницкое');_met(rc_nline_5,'n19','new_line_5','Волоколамское');_met(rc_nline_6,'n20','new_line_6','Можайское');_met(rc_nline_7,'n21','new_line_7','Калужское');rayony(rc1,'.sao_map','САО',230,155);rayony(rc2,'.c3ao_map2','СЗАО',194,188,'.c3ao_map1');rayony(rc3,'.zao','ЗАО',206,248);rayony(rc4,'.juzao','ЮЗАО',228,306);rayony(rc5,'.juao','ЮАО',282,320);rayony(rc6,'.juvao','ЮВАО',325,278);rayony(rc7,'.vao1','ВАО',330,195,'.vao2');rayony(rc8,'.svao','СВАО',270,157);rayony(rc9,'.cao','ЦАО',276,222);rayony(rc10,'.zelen','Зеленоград',-100,-100);}function set_search_param(input_name,value,elem){var form=$('.form');var isset=false;var inputs=$('input[name="'+input_name+'"]',form)
inputs.each(function(){if($(this).val()==value)isset=true;});if(!isset){form.append('<input type="hidden" name="'+input_name+'" value="'+value+'" rel="'+elem+'"/>');}}function remove_search_param(input_name,value){var form=$('.form');var isset=false;var inputs=$('input[name="'+input_name+'"]',form)
inputs.each(function(){if($(this).val()==value)$(this).remove();});}$(function(){$('.search_on_map, .search_by_region, .search_by_shosse').click(function(){$('.search_on_map, .search_by_region, .search_by_shosse').removeClass('active');$(this).toggleClass('active');});$('.search_on_map').click(function(){$('.search_by_region, .search_by_shosse').removeClass('active');$(this).addClass('active');$('.cur-map-arrow').css('top','331px');$('#map_google').show();});$('.search_by_region').click(function(){$('.search_on_map, .search_by_shosse').removeClass('active');$(this).addClass('active');$('.cur-map-arrow').css('top','398px');$('#map_google').hide();});$('.search_by_shosse').click(function(){$('.search_by_region, .search_on_map').removeClass('active');$(this).addClass('active');$('.cur-map-arrow').css('top','366px');$('#map_google').hide();});$('.search-form .reset').click(function(){var form=$('.search-form form');form.trigger('reset')
$('input[name="rayonF[]"], input[name="shosseF[]"]',form).each(function(){console.log("$("+$(this).attr('rel')+").click();");$($(this).attr('rel')).mouseover();$($(this).attr('rel')).click();$($(this).attr('rel')).mouseout();$(this).remove();});deletePolygon();});$('.search-form form').submit(function(){if(polygon!==undefined){$('#selected_coordinates').val(polygon.getPath().getArray());}});});var drawingManager=undefined;var map=undefined;var polygon=undefined;var mapClickTrigger=false;function initialize(){var mapOptions={center:new google.maps.LatLng(55.836,37.575),zoom:7,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map_google"),mapOptions);drawingManager=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:false});drawingManager.setMap(map);google.maps.event.addListener(drawingManager,"overlaycomplete",function(event){polygon=event.overlay;event.overlay.setOptions({editable:true});drawingManager.setDrawingMode(null);$('#selected_coordinates').val(event.overlay.getPath().getArray());console.log(event.overlay.getPath().getArray());});if(typeof buildPolygon==='function'){buildPolygon();mapClickTrigger=true;}if(typeof build_markers_on_map==='function'){build_markers_on_map();}buildClickPolygon();}function buildClickPolygon(){drawingManager.setDrawingMode(null);google.maps.event.addListener(map,'click',function(event){if(!mapClickTrigger){mapClickTrigger=true;var x=event.latLng.lat();var y=event.latLng.lng();var k=1/map.getZoom();var x1=x-k/2;var y1=y-k;var x2=x+k/2;var y2=y-k;var x3=x+k/2;var y3=y+k;var x4=x-k/2;var y4=y+k;var polygonJSCoor=[new google.maps.LatLng(x1,y1),new google.maps.LatLng(x2,y2),new google.maps.LatLng(x3,y3),new google.maps.LatLng(x4,y4),];polygon=new google.maps.Polygon({paths:polygonJSCoor,editable:true,draggable:true});polygon.setMap(map);}});}function deletePolygon(){polygon.setMap(null);polygon=undefined;mapClickTrigger=false;return false;}function changePolygonCreateType(){if(drawingManager.getDrawingMode()=="polygon"){drawingManager.setDrawingMode(null);}else{drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON);}}